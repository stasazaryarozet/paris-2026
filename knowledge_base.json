{
  "project": "paris-art-deco-2026",
  "version": "1.0",
  "created": "2025-10-23",
  "patterns": [
    {
      "id": "pattern-001",
      "category": "build-system",
      "title": "MD → JS генерация без JSON.dumps()",
      "problem": "json.dumps() добавляет кавычки к ключам объекта, превращая JS в JSON",
      "solution": "Использовать кастомную функцию js_object() для рекурсивной генерации чистого JS синтаксиса",
      "code_reference": "build.py:js_object()",
      "severity": "critical",
      "detected": "2025-10-23",
      "impact": "Потеря всего контента на продакшене"
    },
    {
      "id": "pattern-002",
      "category": "parsing",
      "title": "Regex lookahead должен учитывать конец строки",
      "problem": "Regex паттерн (?=\\n### |---) не находит последний элемент в списке",
      "solution": "Добавить \\Z в lookahead: (?=\\n### |\\n---|\\Z)",
      "code_reference": "build.py:parse_content() curators section",
      "severity": "critical",
      "detected": "2025-10-23",
      "impact": "Потеря второго куратора (Наталья)"
    },
    {
      "id": "pattern-003",
      "category": "testing",
      "title": "Автоматическая валидация перед деплоем обязательна",
      "problem": "Отсутствие тестов привело к деплою сломанного контента",
      "solution": "Создать test_build.py с комплексной проверкой всех критических элементов",
      "code_reference": "test_build.py",
      "severity": "critical",
      "detected": "2025-10-23",
      "impact": "Множественные критические ошибки на продакшене"
    },
    {
      "id": "pattern-004",
      "category": "architecture",
      "title": "Единственный источник правды (Single Source of Truth)",
      "problem": "Дублирование данных между MD и JS ведёт к рассинхронизации",
      "solution": "MD — единственный источник, JS — автогенерируется, HTML — статический shell",
      "code_reference": "WEBSITE_CONTENT.md → build.py → content.js",
      "severity": "high",
      "detected": "2025-10-23",
      "impact": "Избыточность архитектуры"
    },
    {
      "id": "pattern-005",
      "category": "workflow",
      "title": "Контрольный список перед коммитом",
      "problem": "Ручные ошибки при работе с контентом",
      "solution": "Строгая последовательность: edit MD → build.py → test_build.py → открыть локально → коммит",
      "code_reference": "ERROR_PREVENTION.md:Контрольный список",
      "severity": "medium",
      "detected": "2025-10-23",
      "impact": "Человеческий фактор"
    },
    {
      "id": "pattern-006",
      "category": "data-integrity",
      "title": "Критические элементы должны проверяться явно",
      "problem": "Потеря критических данных (кураторы, дни, цены) не отлавливалась",
      "solution": "Тесты должны явно проверять наличие всех критических элементов",
      "code_reference": "test_build.py:critical_content list",
      "severity": "critical",
      "detected": "2025-10-23",
      "impact": "Неполный контент на сайте"
    }
  ],
  "best_practices": [
    {
      "category": "general",
      "practice": "TDD (Test-Driven Development)",
      "description": "Сначала тест, потом код. Каждое изменение валидируется.",
      "status": "implemented"
    },
    {
      "category": "general",
      "practice": "Автоматизация превентивных мер",
      "description": "Pre-commit hooks, автоматические тесты, CI/CD",
      "status": "partially-implemented"
    },
    {
      "category": "architecture",
      "practice": "Минимальная избыточность",
      "description": "Один источник правды, автогенерация производных",
      "status": "implemented"
    },
    {
      "category": "documentation",
      "practice": "Контрольные списки и руководства по ошибкам",
      "description": "ERROR_PREVENTION.md, README.md с требованиями тестирования",
      "status": "implemented"
    }
  ],
  "critical_lessons": [
    "Никогда не коммить без запуска test_build.py",
    "Regex должен учитывать edge cases (конец строки, единственный элемент)",
    "JSON.dumps() не подходит для генерации JavaScript",
    "Автоматическая валидация важнее ручной проверки",
    "Документация по предотвращению ошибок должна создаваться сразу после их обнаружения"
  ],
  "metadata": {
    "last_critical_fix": "2025-10-23",
    "total_patterns": 6,
    "architecture_version": "1.0-stable",
    "production_url": "https://parisinjanuary.ru"
  }
}

